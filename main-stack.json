{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"Central-Storage",
   "Parameters":{
      "SystemName":{
         "Default":"NATTest",
         "Description":"System Name",
         "Type":"String"
      },
      "CIDRPrefix":{
         "Default":"10.0",
         "Description":"network cidr prefix",
         "Type":"String",
         "MinLength":"1",
         "MaxLength":"8",
         "ConstraintDescription":"Length is too long"
      },
      "NatInstanceClass":{
         "Default":"t1.micro",
         "Description":"NAT EC2 instance class",
         "Type":"String",
         "AllowedValues":[
            "t1.micro",
            "t2.micro",
            "m1.small",
            "m1.large",
            "m3.medium",
            "m3.large",
            "m3.xlarge",
            "m3.2xlarge",
            "c1.medium",
            "c1.xlarge"
         ],
         "ConstraintDescription":"Please check AllowedValues if constraint happens"
      }
   },
   "Resources":{
      "VPCStack":{
         "Type":"AWS::CloudFormation::Stack",
         "Properties":{
            "TemplateURL":"https://s3.amazonaws.com/chloe-test/cloudformation/vpc-with-public.json",
            "Parameters":{
               "SystemName":{
                  "Ref":"SystemName"
               },
               "CIDRPrefix":{
                  "Ref":"CIDRPrefix"
               }
            }
         }
      },
      "PrivateSubnetStack":{
         "Type":"AWS::CloudFormation::Stack",
         "DependsOn":"VPCStack",
         "Properties":{
            "TemplateURL":"https://s3.amazonaws.com/chloe-test/cloudformation/private-subnet.json",
            "Parameters":{
               "SystemName":{
                  "Ref":"SystemName"
               },
               "CIDRPrefix":{
                  "Ref":"CIDRPrefix"
               },
               "NatInstanceClass":{
                  "Ref":"NatInstanceClass"
               },
               "SubnetPublicA":{
                  "Fn::GetAtt":[
                     "VPCStack",
                     "Outputs.SubnetPublicA"
                  ]
               },
               "SubnetPublicB":{
                  "Fn::GetAtt":[
                     "VPCStack",
                     "Outputs.SubnetPublicB"
                  ]
               },
               "VPC":{
                  "Fn::GetAtt":[
                     "VPCStack",
                     "Outputs.VPC"
                  ]
               }
            }
         }
      }
   },
   "Outputs":{
      "RouteTableInternalA":{
         "Value":{
            "Fn::GetAtt":[
                     "PrivateSubnetStack",
                     "Outputs.RouteTableInternalA"
            ]
         }
      },
      "RouteTableInternalB":{
         "Value":{
            "Fn::GetAtt":[
                     "PrivateSubnetStack",
                     "Outputs.RouteTableInternalB"
            ]
         }
      },
      "myAppInstanceA":{
        "Value":{
            "Fn::GetAtt":[
                     "PrivateSubnetStack",
                     "Outputs.myAppInstanceA"
            ]
         }
      },
      "myAppInstanceB":{
         "Value":{
            "Fn::GetAtt":[
                     "PrivateSubnetStack",
                     "Outputs.myAppInstanceB"
            ]
         }
      }
   }
}