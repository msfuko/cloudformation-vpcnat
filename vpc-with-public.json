{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"VPC setting with private subnets",
   "Parameters":{
      "SystemName":{
         "Default":"Central Storage",
         "Description":"System Name",
         "Type":"String"
      },
      "CIDRPrefix":{
         "Default":"10.0",
         "Description":"network cidr prefix",
         "Type":"String",
         "MinLength":"1",
         "MaxLength":"8",
         "ConstraintDescription":"Length is too long"
      }
   },
   "Resources":{
      "VPC":{
         "Type":"AWS::EC2::VPC",
         "Properties":{
            "CidrBlock":{
               "Fn::Join":[
                  ".",
                  [
                     {
                        "Ref":"CIDRPrefix"
                     },
                     "0.0/16"
                  ]
               ]
            },
            "EnableDnsHostnames":"true",
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Ref":"SystemName"
                  }
               }
            ]
         }
      },
      "SubnetPublicA":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "CidrBlock":{
               "Fn::Join":[
                  ".",
                  [
                     {
                        "Ref":"CIDRPrefix"
                     },
                     "1.0/24"
                  ]
               ]
            },
            "AvailabilityZone":{
               "Fn::Select":[
                  "0",
                  {
                     "Fn::GetAZs":""
                  }
               ]
            },
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        ".",
                        [
                           {
                              "Ref":"SystemName"
                           },
                           "subnet",
                           "public",
                           "a"
                        ]
                     ]
                  }
               }
            ]
         }
      },
      "SubnetPublicB":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "CidrBlock":{
               "Fn::Join":[
                  ".",
                  [
                     {
                        "Ref":"CIDRPrefix"
                     },
                     "2.0/24"
                  ]
               ]
            },
            "AvailabilityZone":{
               "Fn::Select":[
                  "1",
                  {
                     "Fn::GetAZs":""
                  }
               ]
            },
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        ".",
                        [
                           {
                              "Ref":"SystemName"
                           },
                           "subnet",
                           "public",
                           "b"
                        ]
                     ]
                  }
               }
            ]
         }
      },
      "InternetGateway":{
         "Type":"AWS::EC2::InternetGateway",
         "Properties":{
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Ref":"SystemName"
                  }
               }
            ]
         }
      },
      "AttachGateway":{
         "Type":"AWS::EC2::VPCGatewayAttachment",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "InternetGatewayId":{
               "Ref":"InternetGateway"
            }
         }
      },
      "RouteTableInternet":{
         "Type":"AWS::EC2::RouteTable",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        ".",
                        [
                           {
                              "Ref":"SystemName"
                           },
                           "routetable",
                           "internet"
                        ]
                     ]
                  }
               }
            ]
         }
      },
      "RouteInternet":{
         "Type":"AWS::EC2::Route",
         "DependsOn":"AttachGateway",
         "Properties":{
            "RouteTableId":{
               "Ref":"RouteTableInternet"
            },
            "DestinationCidrBlock":"0.0.0.0/0",
            "GatewayId":{
               "Ref":"InternetGateway"
            }
         }
      },
      "SubnetRouteTableInternetAssociationA":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"SubnetPublicA"
            },
            "RouteTableId":{
               "Ref":"RouteTableInternet"
            }
         }
      },
      "SubnetRouteTableInternetAssociationB":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"SubnetPublicB"
            },
            "RouteTableId":{
               "Ref":"RouteTableInternet"
            }
         }
      }
   },
   "Outputs":{
      "VPC":{
         "Value":{
            "Ref":"VPC"
         }
      },
      "SubnetPublicA":{
         "Value":{
            "Ref":"SubnetPublicA"
         }
      },
      "SubnetPublicB":{
         "Value":{
            "Ref":"SubnetPublicB"
         }
      },
      "AvailabilityZoneA":{
         "Value":{
            "Fn::GetAtt":[
               "SubnetPublicA",
               "AvailabilityZone"
            ]
         }
      },
      "AvailabilityZoneB":{
         "Value":{
            "Fn::GetAtt":[
               "SubnetPublicB",
               "AvailabilityZone"
            ]
         }
      }
   }
}